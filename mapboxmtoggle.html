<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>Display a map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src='../d3.js'></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%;z-index:-1; }
    #layerToggle{z-index:999;}
  </style>
</head>
<body>


<div id='map'></div>
<div id="layerToggle">Toggle</div>

<script>


//built in interactions from mapbox 1 - 7
//1.bounds
//found at:https://docs.mapbox.com/mapbox-gl-js/example/restrict-bounds/
 // Set bounds to New York, New York
var bounds = [
[-74.05, 40.695], // Southwest coordinates
[-73.915, 40.78]  // Northeast coordinates
];

//this part of the example can be found at mapbox: https://docs.mapbox.com/mapbox-gl-js/example/simple-map/
//you will find the accessToken and the style for your map under "Share" in your specific map in mapbox studio
mapboxgl.accessToken = 'pk.eyJ1IjoieXczNTYzIiwiYSI6ImNraGc0MXAzdTB2dHcyeHFwdXpsbm1scTMifQ.7nBjOVzW051AMgneu-NuQw';
var map = new mapboxgl.Map({
  container: 'map',//thi sis the div that you have mad above in html that you are now placing your map in
  style: 'mapbox://styles/yw3563/ckhgfy05n12u619t6rgzwodvz',//you will find the accessToken under "Share" in your specific map in mapbox studio
  center: [-73.982, 40.738],//the center of the map can be set to any initial value of [lng,lat]
  zoom: 12.5,//note that some layers have zoom limits - for example, streets and building footprints are not visible when zoomed out
  maxBounds: bounds // Sets bounds as max
});


//2.zoom
map.addControl(new mapboxgl.NavigationControl());

//7.icons
map.on('load', function () {


// Add an image to use as a custom marker
map.loadImage(
'https://raw.githubusercontent.com/CenterForSpatialResearch/fall2020_data_visualization/master/mapbox/star.png',
  function (error, image) {
      if (error) throw error;
      map.addImage('custom-marker', image);
// Add a GeoJSON source with 2 points
      map.addSource('points', {
        'type': 'geojson',
        'data': {
          'type': 'FeatureCollection',
          'features': [
            {
// feature for shake shack
            'type': 'Feature',
            'properties': {
              'description':
                '<strong>Shake Shack</strong><p>11111</p>',
                'title': 'Shake Shack'
             },
            'geometry': {
              'type': 'Point',
              'coordinates': [-73.982, 40.738]
            },

            }
        ]
      }
});

// Add a symbol layer
map.addLayer({
          'id': 'points',
          'type': 'symbol',
          'source': 'points',
          'layout': {
            'icon-image': 'custom-marker',
            'icon-allow-overlap': true,
            'icon-size': 0.1,
// get the title name from the source's "title" property
            'text-field': ['get', 'title'],
            'text-font': [
              'Open Sans Semibold',
              'Arial Unicode MS Bold'
            ],
            'text-offset': [0, 1.25],
            'text-anchor': 'top'
          }
        });
        map.on('click', 'points', function (e) {
          var coordinates = e.features[0].geometry.coordinates.slice();
          var description = e.features[0].properties.description;

// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
          while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}

          new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML(description)
          .addTo(map);
        });

// Change the cursor to a pointer when the mouse is over the places layer.
          map.on('mouseenter', 'places', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

// Change it back to a pointer when it leaves.
          map.on('mouseleave', 'places', function () {
            map.getCanvas().style.cursor = '';
          });
    }
  )
  map.on('click', 'points', function (e) {
          var mouseData = e//this is all the click information from the mouse
          //8.flyto
          //we get the mouseData again, and we zoom in
          flyTo(mouseData)

  })

//9.layers
  console.log(map.getStyle().layers)
  d3.select("#layerToggle").style("z-index",99)
      .on("click",function(){
          //first find out if it is visible or not
          var visibility = map.getLayoutProperty("restaurant_all", 'visibility');
          //make a if else statement so that if it is visible, turn it off, if it is hidden then do the opposite
          if (visibility === 'visible') {
              map.setLayoutProperty("restaurant_all","visibility","none")
          }else{
              map.setLayoutProperty("restaurant_all","visibility","visible")
          }

      })
});


//adding buttons to work with mapbox interactions 8 - 11

//8.flyto
function flyTo(mouseData){
    console.log(mouseData)//all the mousedata
    //the coordinates are in this data as:
    var lat = mouseData.lngLat.lat
    var lng = mouseData.lngLat.lng

    console.log([lat,lng])
    //the example linked below uses basic flyto
    //https://docs.mapbox.com/mapbox-gl-js/example/flyto/

        map.flyTo({
        center: [lng,lat],
            zoom:14
        });

}



//10.data


//11.removing mapbox logo* not recommended in real applications - please adhere to rules when using outside of class



</script>

</body>
</html>
